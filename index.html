<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexyana | The End of Blind Hiring</title>
    <meta name="description" content="Connecting demanding companies and households with audited technicians. Certification for professionals and security for hiring.">
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Leaflet (interactive map) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            dark: '#0f172a', // Slate 900
                            primary: '#0f766e', // Teal 700
                            accent: '#14b8a6', // Teal 500
                            bg: '#f8fafc', // Slate 50
                            danger: '#dc2626', // Red 600
                            gold: '#d97706', // Amber 600
                        }
                    },
                    animation: {
                        'slide-up': 'slideUp 0.5s ease-out',
                        'fade-out': 'fadeOut 0.5s ease-in forwards',
                    },
                    keyframes: {
                        slideUp: {
                            '0%': { transform: 'translateY(100%)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        fadeOut: {
                            '0%': { opacity: '1' },
                            '100%': { opacity: '0' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .tab-active {
            border-bottom: 2px solid #0f766e;
            color: #0f766e;
            font-weight: 600;
        }
        .tab-inactive {
            color: #64748b;
            border-bottom: 2px solid transparent;
        }
        .tab-inactive:hover {
            color: #334155;
            border-bottom: 2px solid #cbd5e1;
        }
        /* Notification Toast Styling */
        .toast-notification {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 50;
            max-width: 320px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="text-slate-800 antialiased relative">

    <!-- Navbar -->
    <nav class="bg-white border-b border-slate-200 sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20 items-center">
                <div class="flex items-center gap-2">
                    <svg class="h-8 w-8 text-brand-primary" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                        <path d="M9 12l2 2 4-4"/>
                    </svg>
                    <a href="#/" onclick="navigate('#/'); return false;" class="font-bold text-xl tracking-tight text-brand-dark">Nexyana</a>
                </div>
                
                <!-- Menu -->
                <div class="flex items-center gap-3">
                    <!-- Language Switcher -->
                    <div class="flex items-center bg-slate-100 rounded-lg p-1 mr-2 md:mr-4">
                        <button onclick="setLanguage('en')" id="btn-en" class="px-3 py-1 text-xs font-bold rounded-md transition-colors bg-white text-brand-primary shadow-sm">EN</button>
                        <button onclick="setLanguage('es')" id="btn-es" class="px-3 py-1 text-xs font-bold rounded-md transition-colors text-slate-500 hover:text-slate-700">ES</button>
                    </div>

                    <div class="hidden md:flex items-center gap-4">
                        <a href="#/empresas" onclick="navigate('#/empresas'); return false;" class="text-sm font-medium text-slate-600 hover:text-brand-primary" data-i18n="nav_companies">Para Empresas</a>
                        <a href="#/hogares" onclick="navigate('#/hogares'); return false;" class="text-sm font-medium text-slate-600 hover:text-brand-primary" data-i18n="nav_homes">Para Hogares</a>
                        <a href="#/talento" onclick="navigate('#/talento'); return false;" class="text-sm font-semibold text-slate-700 hover:text-brand-dark" data-i18n="nav_talent">Soy Talento</a>
                        <a href="#/panel" id="nav-panel" onclick="navigate('#/panel'); return false;" class="hidden bg-white border border-slate-300 text-slate-800 px-4 py-2.5 rounded-lg text-sm font-semibold hover:bg-slate-50 transition" data-i18n="nav_panel">Mi Panel</a>
                        <a href="#/db" onclick="navigate('#/db'); return false;" class="bg-brand-dark text-white px-5 py-2.5 rounded-lg text-sm font-semibold hover:bg-slate-800 transition shadow-lg shadow-slate-900/20" data-i18n="nav_cta">Ver Base</a>
                    </div>

                    <!-- Mobile hamburger -->
                    <button id="mobileMenuBtn" onclick="toggleMobileMenu()" class="md:hidden inline-flex items-center justify-center h-10 w-10 rounded-lg border border-slate-300 bg-white text-slate-700 hover:bg-slate-50" aria-label="Menu" aria-expanded="false">
                        <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Mobile Menu Panel -->
            <div id="mobileMenu" class="md:hidden hidden pb-4">
                <div class="mt-3 bg-white border border-slate-200 rounded-2xl p-3 shadow-sm">
                    <div class="grid grid-cols-1 gap-2">
                        <a href="#/empresas" onclick="navigate('#/empresas'); closeMobileMenu(); return false;" class="px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 font-semibold text-slate-800" data-i18n="nav_companies">Para Empresas</a>
                        <a href="#/hogares" onclick="navigate('#/hogares'); closeMobileMenu(); return false;" class="px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 font-semibold text-slate-800" data-i18n="nav_homes">Para Hogares</a>
                        <a href="#/talento" onclick="navigate('#/talento'); closeMobileMenu(); return false;" class="px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 font-semibold text-slate-800" data-i18n="nav_talent">Soy Talento</a>
                        <a href="#/panel" onclick="navigate('#/panel'); closeMobileMenu(); return false;" class="px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 font-semibold text-slate-800" data-i18n="nav_panel">Mi Panel</a>
                        <a href="#/db" onclick="navigate('#/db'); closeMobileMenu(); return false;" class="px-4 py-3 rounded-xl bg-slate-900 text-white font-extrabold" data-i18n="nav_cta">Ver Base</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="relative bg-brand-dark overflow-hidden">
        <div class="absolute inset-0 opacity-10">
            <svg class="h-full w-full" viewBox="0 0 100 100" preserveAspectRatio="none">
                <path d="M0 100 L100 0 L100 100 Z" fill="white"/>
            </svg>
        </div>

        <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-16 pb-20 lg:pt-24 lg:pb-32 text-center">
            <h1 class="text-4xl md:text-6xl font-extrabold text-white tracking-tight leading-tight mb-6">
                <span data-i18n="hero_title_1">The End of</span> <span class="text-brand-accent" data-i18n="hero_title_2">Blind Hiring</span>
            </h1>
            <p class="text-xl text-slate-300 mb-10 max-w-3xl mx-auto leading-relaxed" data-i18n="hero_subtitle">
                The first platform that audits every expert technically and morally before they enter your company or your home.
            </p>

            <!-- Roles -->
            <div class="flex flex-col md:flex-row justify-center gap-6 max-w-4xl mx-auto">
                <!-- Client Card -->
                <div class="group relative bg-white rounded-2xl p-1 text-left w-full md:w-1/2 hover:scale-[1.02] transition-transform duration-300 cursor-pointer" onclick="navigate('#/db')">
                    <div class="absolute -inset-0.5 bg-gradient-to-r from-brand-accent to-brand-primary rounded-2xl opacity-20 group-hover:opacity-100 blur transition duration-300"></div>
                    <div class="relative bg-white rounded-xl p-6 h-full flex flex-col items-start">
                        <div class="w-12 h-12 bg-blue-50 text-blue-600 rounded-lg flex items-center justify-center mb-4">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        </div>
                        <h3 class="text-xl font-bold text-slate-900" data-i18n="card_client_title">I Need Verified Talent</h3>
                        <p class="text-slate-500 mt-2 text-sm" data-i18n="card_client_desc">Stop risking your assets. Access our database of vetted professionals.</p>
                        <span class="mt-4 text-brand-primary font-bold text-sm flex items-center group-hover:underline">
                            <span data-i18n="card_client_cta">View Safe Profiles</span> <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                        </span>
                    </div>
                </div>

                <!-- Talent Card -->
                <div class="group relative bg-slate-800 rounded-2xl p-1 text-left w-full md:w-1/2 hover:scale-[1.02] transition-transform duration-300 cursor-pointer border border-slate-700" onclick="navigate('#/talento')">
                    <div class="relative bg-slate-900 rounded-xl p-6 h-full flex flex-col items-start">
                        <div class="w-12 h-12 bg-slate-800 text-brand-gold rounded-lg flex items-center justify-center mb-4">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138z"></path></svg>
                        </div>
                        <h3 class="text-xl font-bold text-white" data-i18n="card_talent_title">I am an Expert Pro</h3>
                        <p class="text-slate-400 mt-2 text-sm" data-i18n="card_talent_desc">Tired of competing with amateurs? Prove your skills and charge what you're worth.</p>
                        <span class="mt-4 text-brand-accent font-bold text-sm flex items-center group-hover:underline">
                            <span data-i18n="card_talent_cta">Get Certified Now</span> <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Authority Section -->
    <section id="proceso" class="py-16 bg-white border-b border-slate-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h2 class="text-2xl font-bold text-slate-900 mb-8" data-i18n="process_title">The "Iron-Clad" Validation Standard</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="flex flex-col items-center">
                    <div class="w-16 h-16 bg-brand-bg rounded-full flex items-center justify-center mb-4 text-brand-primary">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
                    </div>
                    <h3 class="font-bold text-slate-800" data-i18n="step1_title">1. Workshop Stress Test</h3>
                    <p class="text-sm text-slate-500 max-w-xs" data-i18n="step1_desc">CVs lie. Hands don't. Candidates must fix real breakdowns in our testing labs.</p>
                </div>
                <div class="flex flex-col items-center">
                    <div class="w-16 h-16 bg-brand-bg rounded-full flex items-center justify-center mb-4 text-brand-primary">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    </div>
                    <h3 class="font-bold text-slate-800" data-i18n="step2_title">2. 360° Background Scan</h3>
                    <p class="text-sm text-slate-500 max-w-xs" data-i18n="step2_desc">We check criminal records, judicial history, and drug screenings. No exceptions.</p>
                </div>
                <div class="flex flex-col items-center">
                    <div class="w-16 h-16 bg-brand-bg rounded-full flex items-center justify-center mb-4 text-brand-primary">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 11c0 3.517-1.009 6.799-2.753 9.571m-3.44-2.04l.054-.09A13.916 13.916 0 008 11a4 4 0 118 0c0 1.017-.07 2.019-.203 3m-2.118 6.844A21.88 21.88 0 0015.171 17m3.839 1.132c.645-2.266.99-4.659.99-7.131A8 8 0 008 4.07M3 15.364c.64-1.319 1-2.8 1-4.364 0-1.457.39-2.823 1.07-4"></path></svg>
                    </div>
                    <h3 class="font-bold text-slate-800" data-i18n="step3_title">3. The Elite 20% Badge</h3>
                    <p class="text-sm text-slate-500 max-w-xs" data-i18n="step3_desc">Only the top 20% survive our filter. If they are on Nexyana, they are the best.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- CLIENT SECTION -->
    <section id="clientes" class="py-20 bg-slate-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-10">
                <span class="text-brand-primary font-bold tracking-wider uppercase text-sm" data-i18n="client_tag">Choose your Peace of Mind</span>
                <h2 class="text-3xl font-bold text-slate-900 mt-2" data-i18n="client_title">Solutions for every risk level</h2>
            </div>

            <!-- Tabs Navigation -->
            <div class="flex justify-center mb-12 border-b border-slate-200">
                <button onclick="switchTab('hogar')" id="tab-hogar" class="tab-active px-6 py-4 text-sm sm:text-base font-medium transition focus:outline-none" data-i18n="tab_home">Households</button>
                <button onclick="switchTab('pyme')" id="tab-pyme" class="tab-inactive px-6 py-4 text-sm sm:text-base font-medium transition focus:outline-none" data-i18n="tab_sme">SMBs</button>
                <button onclick="switchTab('corp')" id="tab-corp" class="tab-inactive px-6 py-4 text-sm sm:text-base font-medium transition focus:outline-none" data-i18n="tab_corp">Corporates</button>
            </div>

            <!-- Content Container -->
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-100 min-h-[400px] transition-all duration-300">
                
                <!-- HOME Content -->
                <div id="content-hogar" class="p-8 md:p-12 flex flex-col md:flex-row gap-8 items-center animate-fade-in">
                    <div class="md:w-1/2">
                        <div class="inline-block px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-bold mb-4" data-i18n="home_badge">FAMILY SAFETY</div>
                        <h3 class="text-2xl font-bold text-slate-900 mb-4" data-i18n="home_head">Who enters your home?</h3>
                        <p class="text-slate-600 mb-6 text-lg" data-i18n="home_desc">Would you give your house keys to a stranger? 65% of informal services end in theft or bad repairs. Don't risk it.</p>
                        <button onclick="openModal('client', 'Acceso Hogar - $49')" class="w-full md:w-auto bg-brand-dark hover:bg-slate-800 text-white font-bold py-3 px-8 rounded-lg transition shadow-lg" data-i18n="home_btn">
                            Book Safe Technician ($49)
                        </button>
                    </div>
                    <div class="md:w-1/2 bg-blue-50 rounded-xl p-6 border border-blue-100">
                        <div class="flex items-center gap-4 mb-4">
                            <div class="h-12 w-12 rounded-full bg-slate-300 flex items-center justify-center text-slate-500 font-bold">CM</div>
                            <div>
                                <div class="font-bold text-slate-800">Carlos M.</div>
                                <div class="text-xs text-slate-500" data-i18n="home_profile">Certified Plumber • Gold Level</div>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div class="h-2 bg-slate-200 rounded w-3/4"></div>
                            <div class="h-2 bg-slate-200 rounded w-1/2"></div>
                            <div class="flex gap-2 mt-4">
                                <span class="bg-green-100 text-green-700 text-xs px-2 py-1 rounded" data-i18n="tag_background">Background OK</span>
                                <span class="bg-blue-100 text-blue-700 text-xs px-2 py-1 rounded" data-i18n="tag_exam">Tech Exam 98/100</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SME Content -->
                <div id="content-pyme" class="hidden p-8 md:p-12 flex flex-col md:flex-row gap-8 items-center animate-fade-in">
                    <div class="md:w-1/2">
                        <div class="inline-block px-3 py-1 bg-teal-50 text-teal-700 rounded-full text-xs font-bold mb-4" data-i18n="sme_badge">PROFIT PROTECTION</div>
                        <h3 class="text-2xl font-bold text-slate-900 mb-4" data-i18n="sme_head">Cheap labor is expensive.</h3>
                        <p class="text-slate-600 mb-6 text-lg" data-i18n="sme_desc">A broken machine costs you $500/hour. An incompetent technician costs you clients. Hire someone who fixes it the first time.</p>
                        <button onclick="openModal('client', 'Membresía PYME - $129')" class="w-full md:w-auto bg-brand-primary hover:bg-teal-800 text-white font-bold py-3 px-8 rounded-lg transition shadow-lg" data-i18n="sme_btn">
                            Start SMB Plan ($129/mo)
                        </button>
                    </div>
                    <div class="md:w-1/2 bg-teal-50 rounded-xl p-8 border border-teal-100 flex items-center justify-center">
                        <div class="text-center">
                            <div class="text-4xl font-bold text-brand-primary mb-2">-40%</div>
                            <p class="text-slate-600 font-medium" data-i18n="sme_stat">Reduction in staff turnover in certified SMBs.</p>
                        </div>
                    </div>
                </div>

                <!-- CORP Content -->
                <div id="content-corp" class="hidden p-8 md:p-12 flex flex-col md:flex-row gap-8 items-center animate-fade-in">
                    <div class="md:w-1/2">
                        <div class="inline-block px-3 py-1 bg-slate-100 text-slate-700 rounded-full text-xs font-bold mb-4" data-i18n="corp_badge">SCALE & COMPLIANCE</div>
                        <h3 class="text-2xl font-bold text-slate-900 mb-4" data-i18n="corp_head">Mass Hiring, Zero Headache.</h3>
                        <p class="text-slate-600 mb-6 text-lg" data-i18n="corp_desc">Need 50 techs in 3 cities by Monday? We have the pre-vetted pool. Integration with your ATS included.</p>
                        <button onclick="openModal('client', 'Plan Corporativo')" class="w-full md:w-auto bg-slate-800 hover:bg-slate-900 text-white font-bold py-3 px-8 rounded-lg transition shadow-lg" data-i18n="corp_btn">
                            Book Strategy Call
                        </button>
                    </div>
                    <div class="md:w-1/2 bg-slate-100 rounded-xl p-8 border border-slate-200">
                        <h4 class="font-bold text-slate-700 mb-4" data-i18n="corp_dash">Corporate Dashboard</h4>
                        <div class="space-y-3">
                            <div class="flex justify-between text-sm text-slate-600"><span data-i18n="dash_active">Active Techs</span> <span class="font-bold">1,240</span></div>
                            <div class="w-full bg-slate-300 rounded-full h-2"><div class="bg-brand-dark h-2 rounded-full" style="width: 85%"></div></div>
                            <div class="flex justify-between text-sm text-slate-600 pt-2"><span data-i18n="dash_trust">Trust Index</span> <span class="font-bold text-green-600">99.8%</span></div>
                            <div class="w-full bg-slate-300 rounded-full h-2"><div class="bg-green-500 h-2 rounded-full" style="width: 98%"></div></div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <!-- TALENT SECTION -->
    <section id="talento" class="py-24 bg-brand-dark relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-brand-accent via-brand-primary to-brand-dark"></div>
        <div class="absolute bottom-0 right-0 -mb-20 -mr-20 w-96 h-96 bg-brand-gold rounded-full opacity-5 blur-[100px]"></div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">
                
                <div>
                    <span class="text-brand-gold font-bold tracking-wider uppercase text-sm mb-2 block" data-i18n="talent_tag">For The Professional</span>
                    <h2 class="text-4xl md:text-5xl font-extrabold text-white mb-6 leading-tight">
                        <span data-i18n="talent_head_1">Stop competing on price.</span> <br>
                        <span class="text-transparent bg-clip-text bg-gradient-to-r from-brand-accent to-white" data-i18n="talent_head_2">Get paid for your quality.</span>
                    </h2>
                    <p class="text-lg text-slate-300 mb-8" data-i18n="talent_desc">
                        Amateurs charge cheap and ruin the market. You are an expert. Prove it. Our badge separates you from the crowd and gets you clients who value skill over savings.
                    </p>

                    <div class="space-y-6 mb-10">
                        <div class="flex items-start">
                            <div class="flex-shrink-0 h-10 w-10 flex items-center justify-center rounded-lg bg-slate-800 border border-slate-700 text-brand-gold">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138z"></path></svg>
                            </div>
                            <div class="ml-4">
                                <h4 class="text-lg font-bold text-white" data-i18n="feat1_title">The "Elite" Badge</h4>
                                <p class="text-slate-400 text-sm" data-i18n="feat1_desc">A physical and digital seal that instantly builds trust with homeowners and CEOs.</p>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <div class="flex-shrink-0 h-10 w-10 flex items-center justify-center rounded-lg bg-slate-800 border border-slate-700 text-brand-gold">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            </div>
                            <div class="ml-4">
                                <h4 class="text-lg font-bold text-white" data-i18n="feat2_title">Premium Rates</h4>
                                <p class="text-slate-400 text-sm" data-i18n="feat2_desc">Our certified pros earn 35% more because they offer zero risk to the client.</p>
                            </div>
                        </div>
                    </div>

                    <div class="flex flex-col sm:flex-row gap-4">
                        <button onclick="openModal('talent', 'Examen de Certificación - $20')" class="px-8 py-4 bg-gradient-to-r from-brand-accent to-brand-primary hover:from-teal-400 hover:to-teal-600 text-white font-bold rounded-lg shadow-lg shadow-teal-900/50 transform transition hover:-translate-y-1" data-i18n="talent_btn">
                            Claim My Badge ($20)
                        </button>
                    </div>
                </div>

                <!-- Visual Element for Talent -->
                <div class="relative hidden lg:block">
                    <div class="bg-slate-800 rounded-2xl p-6 border border-slate-700 transform rotate-2 hover:rotate-0 transition duration-500 shadow-2xl">
                        <div class="flex items-center justify-between mb-6 border-b border-slate-700 pb-4">
                            <div>
                                <h3 class="text-white font-bold text-lg" data-i18n="cert_title">Competence Certificate</h3>
                                <p class="text-slate-400 text-xs">ID: NEX-8821-X</p>
                            </div>
                            <div class="text-brand-gold">
                                <svg class="w-10 h-10" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-slate-400" data-i18n="cert_spec">Specialty</span>
                                <span class="text-white font-semibold">Industrial Electrician</span>
                            </div>
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-slate-400" data-i18n="cert_score">Technical Score</span>
                                <span class="text-green-400 font-semibold">98/100</span>
                            </div>
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-slate-400" data-i18n="cert_bg">Background</span>
                                <span class="text-green-400 font-semibold">VERIFIED</span>
                            </div>
                        </div>
                        <div class="mt-6 pt-4 border-t border-slate-700 text-center">
                            <span class="text-brand-accent text-xs font-mono tracking-widest">VALIDATED BY NEXYANA</span>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <!-- APP PORTALS (Static mock + localStorage) -->
    <section id="portal" class="py-16 bg-slate-50 border-t border-slate-200 hidden">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
                <div>
                    <h2 class="text-2xl font-extrabold text-slate-900" data-i18n="portal_title">Portal Nexyana (Demo)</h2>
                    <p class="text-slate-600" data-i18n="portal_subtitle">Mock estático que se siente real: recuerda tus acciones y desbloquea secciones.</p>
                </div>
                <div class="flex flex-col sm:flex-row gap-2">
                    <button onclick="navigate('#/db')" class="px-4 py-2 rounded-lg bg-white border border-slate-300 text-slate-800 font-semibold hover:bg-slate-50" data-i18n="portal_btn_db">Ir a la base</button>
                    <button onclick="navigate('#/panel')" class="px-4 py-2 rounded-lg bg-white border border-slate-300 text-slate-800 font-semibold hover:bg-slate-50" data-i18n="portal_btn_panel">Ir a mi panel</button>
                    <button onclick="resetDemo()" class="px-4 py-2 rounded-lg bg-slate-900 text-white font-semibold hover:bg-slate-800" data-i18n="portal_btn_reset">Reiniciar demo</button>
                </div>
            </div>

            <!-- CLIENT: DATABASE -->
            <div id="portal-db" class="hidden">
                <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
                    <div class="p-6 md:p-8 border-b border-slate-200">
                        <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-4">
                            <div>
                                <div class="text-xs font-bold tracking-wider text-brand-primary uppercase" data-i18n="db_tag">Base de Datos Nexyana</div>
                                <h3 class="text-2xl font-extrabold text-slate-900" data-i18n="db_title">Talento verificado con señales de confianza</h3>
                                <p class="text-slate-600 mt-1" data-i18n="db_desc">Filtra y previsualiza perfiles. El contacto se oculta hasta desbloquear.</p>
                            </div>
                            <div class="flex flex-col sm:flex-row gap-2">
                                <button id="dbUnlockBtn" onclick="openCheckout()" class="px-5 py-3 rounded-lg bg-brand-dark text-white font-bold hover:bg-slate-800 shadow-lg shadow-slate-900/10" data-i18n="db_unlock_btn">Desbloquear Acceso ($49)</button>
                                <button onclick="scrollToSection('clientes')" class="px-5 py-3 rounded-lg bg-white border border-slate-300 text-slate-800 font-bold hover:bg-slate-50" data-i18n="db_back_btn">Ver planes</button>
                            </div>
                        </div>
                    </div>

                    <div class="p-6 md:p-8">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1" data-i18n="db_filter_trade">Oficio</label>
                                <select id="dbFilterTrade" class="w-full border-slate-300 rounded-md shadow-sm p-3 border focus:ring-brand-primary focus:border-brand-primary" onchange="renderDb()">
                                    <option value="all" data-i18n="db_filter_all">Todos</option>
                                    <option value="Plumber">Plumber</option>
                                    <option value="Electrician">Electrician</option>
                                    <option value="Carpenter">Carpenter</option>
                                    <option value="Dishwasher">Dishwasher</option>
                                    <option value="Cleaning">Cleaning</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1" data-i18n="db_filter_city">Ciudad</label>
                                <input id="dbFilterCity" type="text" placeholder="Quito" class="w-full border-slate-300 rounded-md shadow-sm p-3 border focus:ring-brand-primary focus:border-brand-primary" oninput="renderDb()">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1" data-i18n="db_filter_zone">Zona</label>
                                <select id="dbFilterZone" class="w-full border-slate-300 rounded-md shadow-sm p-3 border focus:ring-brand-primary focus:border-brand-primary" onchange="renderDb()">
                                    <option value="any" data-i18n="db_zone_any">Cualquiera</option>
                                    <option value="Norte" data-i18n="db_zone_north">Quito Norte</option>
                                    <option value="Centro" data-i18n="db_zone_center">Quito Centro</option>
                                    <option value="Sur" data-i18n="db_zone_south">Quito Sur</option>
                                    <option value="Valles" data-i18n="db_zone_valleys">Valles (Cumbayá/Tumbaco)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1" data-i18n="db_filter_trust">Filtros de confianza</label>
                                <select id="dbFilterTrust" class="w-full border-slate-300 rounded-md shadow-sm p-3 border focus:ring-brand-primary focus:border-brand-primary" onchange="renderDb()">
                                    <option value="any" data-i18n="db_trust_any">Cualquiera</option>
                                    <option value="bg_ok" data-i18n="db_trust_bg">Antecedentes verificados</option>
                                    <option value="score_90" data-i18n="db_trust_score">Score 90+</option>
                                    <option value="verified" data-i18n="db_trust_verified">Verificado por Nexyana</option>
                                </select>
                            </div>
                        </div>

                        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3 mb-6">
                            <div class="flex flex-col sm:flex-row gap-2">
                                <div class="inline-flex rounded-lg border border-slate-300 bg-white p-1 w-full sm:w-auto">
                                    <button id="dbViewListBtn" onclick="setDbView('list')" class="px-3 py-2 text-sm font-bold rounded-md bg-slate-900 text-white" data-i18n="db_view_list">Lista</button>
                                    <button id="dbViewMapBtn" onclick="setDbView('map')" class="px-3 py-2 text-sm font-bold rounded-md text-slate-700 hover:bg-slate-50" data-i18n="db_view_map">Mapa</button>
                                </div>
                                <div class="flex items-center gap-2">
                                    <label class="text-sm font-medium text-slate-700 whitespace-nowrap" data-i18n="db_segment_label">Segmento</label>
                                    <select id="dbDemandSegment" class="w-full sm:w-auto border-slate-300 rounded-md shadow-sm p-2.5 border focus:ring-brand-primary focus:border-brand-primary" onchange="renderDbMap()">
                                        <option value="home" data-i18n="seg_particular">Particular</option>
                                        <option value="sme" data-i18n="seg_sme">PYME</option>
                                        <option value="corp" data-i18n="seg_corp">Corporativo</option>
                                    </select>
                                </div>
                            </div>
                            <div class="flex flex-col sm:flex-row gap-2">
                                <button id="geoBtn" onclick="requestGeo()" class="px-4 py-2 rounded-lg bg-white border border-slate-300 text-slate-800 font-semibold hover:bg-slate-50" data-i18n="db_geo_btn">Usar mi ubicación (opcional)</button>
                                <button id="geoClearBtn" onclick="clearGeo()" class="px-4 py-2 rounded-lg bg-white border border-slate-300 text-slate-800 font-semibold hover:bg-slate-50" data-i18n="db_geo_clear">Olvidar ubicación</button>
                            </div>
                        </div>

                        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-6">
                            <p class="text-xs text-slate-500" data-i18n="db_geo_note">Funciona en HTTPS o localhost. Se guarda solo en tu navegador.</p>
                        </div>

                        <div class="relative">
                            <div id="dbLockedOverlay" class="hidden absolute inset-0 z-10 bg-white/70 backdrop-blur-sm rounded-2xl border border-slate-200 flex items-center justify-center p-6">
                                <div class="max-w-md text-center">
                                    <div class="mx-auto h-12 w-12 rounded-full bg-slate-900 text-white flex items-center justify-center mb-3">
                                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 11c1.657 0 3-.895 3-2s-1.343-2-3-2-3 .895-3 2 1.343 2 3 2z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 11h14v10H5z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11V8a5 5 0 0110 0v3"/></svg>
                                    </div>
                                    <h4 class="text-lg font-extrabold text-slate-900" data-i18n="db_locked_title">Datos protegidos</h4>
                                    <p class="text-sm text-slate-600 mt-1" data-i18n="db_locked_desc">Desbloquea para ver contacto + evidencia (mock para demo MVP).</p>
                                    <button onclick="openCheckout()" class="mt-4 px-5 py-3 rounded-lg bg-brand-primary text-white font-bold hover:bg-teal-800 shadow-lg shadow-teal-900/20" data-i18n="db_locked_cta">Desbloquear ahora</button>
                                </div>
                            </div>

                            <!-- LIST VIEW -->
                            <div id="dbListView">
                                <div id="dbResults" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <!-- rendered by JS -->
                                </div>
                            </div>

                            <!-- MAP VIEW -->
                            <div id="dbMapView" class="hidden">
                                <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                                    <div class="lg:col-span-2">
                                        <div class="bg-slate-50 border border-slate-200 rounded-2xl overflow-hidden">
                                            <div class="flex items-center justify-between px-4 py-3 bg-white border-b border-slate-200">
                                                <div>
                                                    <div class="text-xs font-bold tracking-wider text-brand-primary uppercase" data-i18n="db_map_tag">Mapa (Demo)</div>
                                                    <div class="text-sm font-extrabold text-slate-900" data-i18n="db_map_title">Disponibilidad + demanda por segmento</div>
                                                </div>
                                                <div class="text-xs text-slate-500" data-i18n="db_map_hint">Toca un pin para ver detalles</div>
                                            </div>
                                            <div class="w-full bg-slate-100">
                                                <div id="dbLeafletMap" class="w-full h-[340px] sm:h-[420px] lg:h-[520px]"></div>
                                            </div>
                                            <div class="px-4 py-3 bg-white border-t border-slate-200 text-xs text-slate-600 flex flex-col sm:flex-row gap-2 sm:items-center sm:justify-between">
                                                <div class="flex items-center gap-3">
                                                    <span class="inline-flex items-center gap-1"><span class="inline-block h-2 w-2 rounded-full bg-brand-primary"></span><span data-i18n="db_map_legend_supply">Talento</span></span>
                                                    <span class="inline-flex items-center gap-1"><span class="inline-block h-2 w-2 rounded-full bg-brand-gold"></span><span data-i18n="db_map_legend_demand">Demanda</span></span>
                                                    <span class="inline-flex items-center gap-1"><span class="inline-block h-2 w-2 rounded-full bg-slate-900"></span><span data-i18n="db_map_legend_you">Tú</span></span>
                                                </div>
                                                <div class="text-slate-500" id="dbMapStats">—</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="bg-white border border-slate-200 rounded-2xl p-4">
                                        <div class="text-sm font-extrabold text-slate-900" data-i18n="db_map_detail_title">Detalle</div>
                                        <p class="text-xs text-slate-500 mt-1" data-i18n="db_map_detail_desc">Selecciona un punto del mapa.</p>
                                        <div id="dbMapDetail" class="mt-4">
                                            <div class="bg-slate-50 border border-slate-200 rounded-xl p-4 text-sm text-slate-600" data-i18n="db_map_detail_empty">
                                                Ningún punto seleccionado.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TALENT: DASHBOARD -->
            <div id="portal-panel" class="hidden">
                <div class="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
                    <div class="p-6 md:p-8 border-b border-slate-200">
                        <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4">
                            <div>
                                <div class="text-xs font-bold tracking-wider text-brand-primary uppercase" data-i18n="panel_tag">Portal de Talento</div>
                                <h3 class="text-2xl font-extrabold text-slate-900" data-i18n="panel_title">Tu ruta de verificación</h3>
                                <p class="text-slate-600 mt-1" data-i18n="panel_desc">Dashboard simple (mock) que cambia a medida que avanzas.</p>
                            </div>
                            <div class="flex flex-col sm:flex-row gap-2">
                                <button onclick="simulateTalentAdvance()" class="px-4 py-2 rounded-lg bg-white border border-slate-300 text-slate-800 font-semibold hover:bg-slate-50" data-i18n="panel_btn_advance">Avanzar paso (demo)</button>
                                <button onclick="navigate('#/db')" class="px-4 py-2 rounded-lg bg-brand-dark text-white font-semibold hover:bg-slate-800" data-i18n="panel_btn_db">Ver base</button>
                            </div>
                        </div>
                    </div>

                    <div class="p-6 md:p-8">
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div class="lg:col-span-2">
                                <div class="mb-4">
                                    <div class="flex items-center justify-between text-sm text-slate-600">
                                        <span data-i18n="panel_progress">Progreso</span>
                                        <span class="font-bold text-slate-800" id="talentProgressLabel">0%</span>
                                    </div>
                                    <div class="w-full bg-slate-200 rounded-full h-2 mt-2">
                                        <div id="talentProgressBar" class="bg-brand-primary h-2 rounded-full" style="width: 0%"></div>
                                    </div>
                                </div>

                                <div class="space-y-3" id="talentSteps">
                                    <!-- rendered by JS -->
                                </div>
                            </div>

                            <div class="bg-slate-50 border border-slate-200 rounded-xl p-5">
                                <h4 class="font-extrabold text-slate-900" data-i18n="panel_card_title">Tu ID Nexyana</h4>
                                <p class="text-sm text-slate-600 mt-1" data-i18n="panel_card_desc">Muestra este QR en el centro de examen (mock).</p>
                                <div class="mt-4 bg-white border border-slate-200 rounded-xl p-4">
                                    <div class="text-xs text-slate-500 font-mono">ID</div>
                                    <div class="text-lg font-extrabold text-slate-900 font-mono tracking-wider" id="talentId">NEX-0000</div>
                                    <div class="mt-3 grid grid-cols-8 gap-1" aria-hidden="true">
                                        <div class="h-2 bg-slate-900"></div><div class="h-2 bg-slate-200"></div><div class="h-2 bg-slate-900"></div><div class="h-2 bg-slate-200"></div><div class="h-2 bg-slate-900"></div><div class="h-2 bg-slate-200"></div><div class="h-2 bg-slate-900"></div><div class="h-2 bg-slate-200"></div>
                                        <div class="h-2 bg-slate-200"></div><div class="h-2 bg-slate-900"></div><div class="h-2 bg-slate-200"></div><div class="h-2 bg-slate-900"></div><div class="h-2 bg-slate-200"></div><div class="h-2 bg-slate-900"></div><div class="h-2 bg-slate-200"></div><div class="h-2 bg-slate-900"></div>
                                        <div class="h-2 bg-slate-900"></div><div class="h-2 bg-slate-200"></div><div class="h-2 bg-slate-900"></div><div class="h-2 bg-slate-200"></div><div class="h-2 bg-slate-900"></div><div class="h-2 bg-slate-200"></div><div class="h-2 bg-slate-900"></div><div class="h-2 bg-slate-200"></div>
                                    </div>
                                </div>

                                <div class="mt-4 text-xs text-slate-500">
                                    <button onclick="openModal('talent', 'Examen de Certificación - $20')" class="underline text-brand-primary font-bold" data-i18n="panel_card_cta">Actualizar mi perfil</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-white border-t border-slate-200 pt-12 pb-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col md:flex-row justify-between items-center">
            <div class="mb-4 md:mb-0">
                <span class="font-bold text-xl text-brand-dark">Nexyana</span>
                <p class="text-slate-500 text-sm mt-1" data-i18n="footer_tag">The new standard of trust.</p>
            </div>
            <div class="text-center mt-8 text-xs text-slate-400">
                &copy; 2024 Nexyana Inc.
            </div>
        </div>
    </footer>

    <!-- REAL TIME NOTIFICATION TOAST -->
    <div id="toast" class="toast-notification bg-white border border-slate-200 rounded-lg p-4 flex items-center gap-3 hidden transform translate-y-full transition-all duration-500">
        <div class="h-10 w-10 rounded-full bg-brand-primary/10 flex items-center justify-center text-brand-primary">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
        </div>
        <div>
            <p class="text-sm font-bold text-slate-800" id="toast-title">New Registration</p>
            <p class="text-xs text-slate-500" id="toast-body">Juan P. just registered.</p>
        </div>
    </div>

    <!-- UNIFIED DUAL MODAL -->
    <div id="validationModal" class="fixed inset-0 z-50 hidden overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-slate-900 bg-opacity-80 transition-opacity backdrop-blur-sm" onclick="closeModal()"></div>

        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

            <div class="inline-block align-bottom bg-white rounded-2xl text-left overflow-hidden shadow-2xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg w-full relative">
                
                <button onclick="closeModal()" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 z-10">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>

                <div id="modalHeader" class="px-6 py-6 border-b border-slate-100">
                    <h3 class="text-xl font-bold text-brand-dark" id="modalTitle">Dynamic Title</h3>
                    <p class="text-sm text-slate-500 mt-1" id="modalSubtitle">Dynamic Subtitle</p>
                </div>

                <div class="px-6 py-6">
                    <form id="leadForm" onsubmit="submitForm(event)">
                        <input type="hidden" id="leadType" name="type">
                        <input type="hidden" id="planInterest" name="plan">
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-4">
                            <div class="md:col-span-1">
                                <label class="block text-sm font-medium text-slate-700 mb-1" data-i18n="form_name">Full name</label>
                                <input id="leadName" type="text" placeholder="Juan Pérez" class="w-full border-slate-300 rounded-md shadow-sm p-3 border focus:ring-brand-primary focus:border-brand-primary">
                            </div>
                            <div class="md:col-span-1">
                                <label class="block text-sm font-medium text-slate-700 mb-1" data-i18n="form_phone">WhatsApp (optional)</label>
                                <input id="leadPhone" type="tel" placeholder="+593 99 999 9999" class="w-full border-slate-300 rounded-md shadow-sm p-3 border focus:ring-brand-primary focus:border-brand-primary">
                            </div>
                        </div>
                        
                        <div id="talentFields" class="hidden mb-4">
                            <label class="block text-sm font-medium text-slate-700 mb-1" data-i18n="form_role">Your Trade / Specialty</label>
                            <select id="talentTrade" class="w-full border-slate-300 rounded-md shadow-sm p-3 border focus:ring-brand-primary focus:border-brand-primary">
                                <option value="Plumber">Plumber</option>
                                <option value="Electrician">Electrician</option>
                                <option value="Carpenter">Carpenter</option>
                                <option value="Dishwasher">Dishwasher (Kitchen)</option>
                                <option value="Cleaning">Cleaning</option>
                                <option value="Other">Other</option>
                            </select>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-3">
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1" data-i18n="form_years">Years of experience</label>
                                    <input id="talentYears" type="number" min="0" max="60" placeholder="5" class="w-full border-slate-300 rounded-md shadow-sm p-3 border focus:ring-brand-primary focus:border-brand-primary">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1" data-i18n="form_city">City</label>
                                    <input id="talentCity" type="text" placeholder="Quito" class="w-full border-slate-300 rounded-md shadow-sm p-3 border focus:ring-brand-primary focus:border-brand-primary">
                                </div>
                            </div>
                            <div class="mt-3">
                                <label class="block text-sm font-medium text-slate-700 mb-1" data-i18n="form_docs">ID / proof of address (mock)</label>
                                <input id="talentDocs" type="file" multiple class="w-full text-sm text-slate-600 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-slate-100 file:text-slate-800 hover:file:bg-slate-200">
                            </div>
                        </div>

                        <div id="clientFields" class="hidden mb-4">
                            <label class="block text-sm font-medium text-slate-700 mb-1" data-i18n="form_need">What profile are you looking to hire?</label>
                            <input id="clientNeed" type="text" placeholder="e.g., Urgent Plumber..." class="w-full border-slate-300 rounded-md shadow-sm p-3 border focus:ring-brand-primary focus:border-brand-primary">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-3">
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1" data-i18n="form_segment">Segment</label>
                                    <select id="clientSegment" class="w-full border-slate-300 rounded-md shadow-sm p-3 border focus:ring-brand-primary focus:border-brand-primary">
                                        <option value="home" data-i18n="seg_home">Home</option>
                                        <option value="sme" data-i18n="seg_sme">SMB</option>
                                        <option value="corp" data-i18n="seg_corp">Corporate</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-1" data-i18n="form_city">City</label>
                                    <input id="clientCity" type="text" placeholder="Quito" class="w-full border-slate-300 rounded-md shadow-sm p-3 border focus:ring-brand-primary focus:border-brand-primary">
                                </div>
                            </div>
                        </div>

                        <div class="mb-6">
                            <label class="block text-sm font-medium text-slate-700 mb-1" data-i18n="form_email">Your Email</label>
                            <input id="leadEmail" type="email" required placeholder="name@example.com" class="w-full border-slate-300 rounded-md shadow-sm p-3 border focus:ring-brand-primary focus:border-brand-primary">
                        </div>

                        <button type="submit" id="submitBtn" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-bold text-white bg-brand-primary hover:bg-teal-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-primary transition-colors">
                            Continue
                        </button>
                    </form>

                    <div id="successMessage" class="hidden text-center py-4">
                        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4">
                            <svg class="h-6 w-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                        </div>
                        <h3 class="text-lg font-medium text-slate-900" data-i18n="success_title">Received!</h3>
                        <p class="text-sm text-slate-500 mt-2" data-i18n="success_desc">We have sent the next steps to your email.</p>
                        <div id="successActions" class="mt-5 flex flex-col sm:flex-row gap-2 justify-center">
                            <!-- rendered by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- TRANSLATIONS CONFIG ---
        const translations = {
            en: {
                nav_companies: "For Companies",
                nav_homes: "For Homes",
                nav_talent: "Join as Talent",
                nav_panel: "My Panel",
                nav_cta: "View Nexyana DB",
                nav_how: "Our Standard",
                nav_pro: "For Talent",
                nav_hire: "Find Talent",
                hero_title_1: "The End of",
                hero_title_2: "Blind Hiring",
                hero_subtitle: "The first platform that audits every expert technically and morally before they enter your company or your home.",
                card_client_title: "I Need Verified Talent",
                card_client_desc: "Stop risking your assets. Access our database of vetted professionals.",
                card_client_cta: "View Safe Profiles",
                card_talent_title: "I am an Expert Pro",
                card_talent_desc: "Tired of competing with amateurs? Prove your skills and charge what you're worth.",
                card_talent_cta: "Get Certified Now",
                process_title: "The \"Iron-Clad\" Validation Standard",
                step1_title: "1. Workshop Stress Test",
                step1_desc: "CVs lie. Hands don't. Candidates must fix real breakdowns in our testing labs.",
                step2_title: "2. 360° Background Scan",
                step2_desc: "We check criminal records, judicial history, and drug screenings. No exceptions.",
                step3_title: "3. The Elite 20% Badge",
                step3_desc: "Only the top 20% survive our filter. If they are on Nexyana, they are the best.",
                client_tag: "Choose your Peace of Mind",
                client_title: "Solutions for every risk level",
                tab_home: "Households",
                tab_sme: "SMBs",
                tab_corp: "Corporates",
                home_badge: "FAMILY SAFETY",
                home_head: "Who enters your home?",
                home_desc: "Would you give your house keys to a stranger? 65% of informal services end in theft or bad repairs. Don't risk it.",
                home_btn: "Book Safe Technician ($49)",
                home_profile: "Certified Plumber • Gold Level",
                tag_background: "Background OK",
                tag_exam: "Tech Exam 98/100",
                sme_badge: "PROFIT PROTECTION",
                sme_head: "Cheap labor is expensive.",
                sme_desc: "A broken machine costs you $500/hour. An incompetent technician costs you clients. Hire someone who fixes it the first time.",
                sme_btn: "Start SMB Plan ($129/mo)",
                sme_stat: "Reduction in staff turnover in certified SMBs.",
                corp_badge: "SCALE & COMPLIANCE",
                corp_head: "Mass Hiring, Zero Headache.",
                corp_desc: "Need 50 techs in 3 cities by Monday? We have the pre-vetted pool. Integration with your ATS included.",
                corp_btn: "Book Strategy Call",
                corp_dash: "Corporate Dashboard",
                dash_active: "Active Techs",
                dash_trust: "Trust Index",
                talent_tag: "For The Professional",
                talent_head_1: "Stop competing on price.",
                talent_head_2: "Get paid for your quality.",
                talent_desc: "Amateurs charge cheap and ruin the market. You are an expert. Prove it. Our badge separates you from the crowd and gets you clients who value skill over savings.",
                feat1_title: "The \"Elite\" Badge",
                feat1_desc: "A physical and digital seal that instantly builds trust with homeowners and CEOs.",
                feat2_title: "Premium Rates",
                feat2_desc: "Our certified pros earn 35% more because they offer zero risk to the client.",
                talent_btn: "Claim My Badge ($20)",
                cert_title: "Competence Certificate",
                cert_spec: "Specialty",
                cert_score: "Technical Score",
                cert_bg: "Background",
                footer_tag: "The new standard of trust.",
                portal_title: "Nexyana Portal (Demo)",
                portal_subtitle: "This is a static mock that feels real: it remembers your actions and unlocks sections.",
                portal_btn_db: "Go to DB",
                portal_btn_panel: "Go to Panel",
                portal_btn_reset: "Reset demo",
                db_tag: "Nexyana Database",
                db_title: "Verified talent, with trust signals",
                db_desc: "Filter and preview profiles. Contact is hidden until you unlock.",
                db_unlock_btn: "Unlock Access ($49)",
                db_back_btn: "See plans",
                db_filter_trade: "Trade",
                db_filter_city: "City",
                db_filter_zone: "Zone",
                db_filter_trust: "Trust filters",
                db_filter_all: "All",
                db_zone_any: "Any",
                db_zone_north: "Quito North",
                db_zone_center: "Quito Center",
                db_zone_south: "Quito South",
                db_zone_valleys: "Valleys (Cumbayá/Tumbaco)",
                db_trust_any: "Any",
                db_trust_bg: "Background verified",
                db_trust_score: "Score 90+",
                db_trust_verified: "Verified by Nexyana",
                db_geo_btn: "Use my location (optional)",
                db_geo_clear: "Forget location",
                db_geo_note: "Works on HTTPS or localhost. Stored only in your browser.",
                db_view_list: "List",
                db_view_map: "Map",
                db_segment_label: "Segment",
                seg_particular: "Individual",
                db_map_tag: "Map (Demo)",
                db_map_title: "Availability + demand by segment",
                db_map_hint: "Tap a pin to see details",
                db_map_legend_supply: "Supply",
                db_map_legend_demand: "Demand",
                db_map_legend_you: "You",
                db_map_detail_title: "Details",
                db_map_detail_desc: "Select a point on the map.",
                db_map_detail_empty: "No point selected.",
                db_locked_title: "Contact details are protected",
                db_locked_desc: "Unlock to view contact + trust evidence (mock).",
                db_locked_cta: "Unlock now",
                panel_tag: "Talent Portal",
                panel_title: "Your verification journey",
                panel_desc: "A simple progress dashboard (static mock) that updates as you take actions.",
                panel_btn_advance: "Advance step (demo)",
                panel_btn_db: "See DB",
                panel_progress: "Progress",
                panel_card_title: "Your Nexyana ID",
                panel_card_desc: "Show this QR at the exam center (mock).",
                panel_card_cta: "Update my profile",
                form_name: "Full name",
                form_phone: "WhatsApp (optional)",
                form_years: "Years of experience",
                form_city: "City",
                form_docs: "ID / proof of address (mock)",
                form_segment: "Segment",
                seg_home: "Home",
                seg_sme: "SMB",
                seg_corp: "Corporate",
                form_role: "Your Trade / Specialty",
                form_need: "What profile are you looking to hire?",
                form_email: "Your Email",
                success_title: "Received!",
                success_desc: "We have sent the next steps to your email.",
                modal_talent_title: "Reserve your exam date",
                modal_talent_subtitle: "We are opening spots for technical certification in your area.",
                modal_client_title: "You are one step away from hiring safely",
                modal_client_subtitle: "Secure your preferential rate.",
                btn_continue: "Continue",
                success_to_panel: "Go to my panel",
                success_to_checkout: "Continue to unlock (mock)",
                success_to_db: "Go to database"
            },
            es: {
                nav_companies: "Para Empresas",
                nav_homes: "Para Hogares",
                nav_talent: "Soy Talento (Únete)",
                nav_panel: "Mi Panel",
                nav_cta: "Ver Base de Datos",
                nav_how: "Nuestro Estándar",
                nav_pro: "Para Talento",
                nav_hire: "Buscar Talento",
                hero_title_1: "El Fin de la",
                hero_title_2: "Contratación a Ciegas",
                hero_subtitle: "La primera plataforma que audita técnica y moralmente a cada experto antes de que entre a tu empresa o a tu casa.",
                card_client_title: "Necesito Talento Verificado",
                card_client_desc: "Deja de arriesgar tu patrimonio. Accede a nuestra base de profesionales filtrados.",
                card_client_cta: "Ver Perfiles Seguros",
                card_talent_title: "Soy un Experto",
                card_talent_desc: "¿Cansado de competir con novatos baratos? Demuestra tu nivel y cobra lo justo.",
                card_talent_cta: "Certificarme Ahora",
                process_title: "El Estándar de Validación \"Blindado\"",
                step1_title: "1. Prueba de Fuego en Taller",
                step1_desc: "El papel aguanta todo. Las manos no. Los candidatos deben reparar averías reales en nuestros laboratorios.",
                step2_title: "2. Escaneo de Antecedentes 360°",
                step2_desc: "Revisamos historial penal, judicial y antidoping. Sin excepciones.",
                step3_title: "3. La Insignia del 20%",
                step3_desc: "Solo el Top 20% sobrevive al filtro. Si están en Nexyana, son los mejores.",
                client_tag: "Elige tu Tranquilidad",
                client_title: "Soluciones para cada nivel de riesgo",
                tab_home: "Hogares",
                tab_sme: "PYMEs",
                tab_corp: "Corporativos",
                home_badge: "SEGURIDAD FAMILIAR",
                home_head: "¿Quién entra a tu casa?",
                home_desc: "¿Le darías las llaves de tu casa a un extraño? El 65% de los servicios informales terminan en robos o malas reparaciones. No te arriesgues.",
                home_btn: "Pedir Técnico Seguro ($49)",
                home_profile: "Plomero Certificado • Nivel Oro",
                tag_background: "Antecedentes OK",
                tag_exam: "Examen Técnico 98/100",
                sme_badge: "PROTECCIÓN DE UTILIDADES",
                sme_head: "Lo barato sale caro.",
                sme_desc: "Una máquina parada te cuesta $500/hora. Un técnico incompetente te cuesta clientes. Contrata a quien lo arregla a la primera.",
                sme_btn: "Plan PYME ($129/mes)",
                sme_stat: "Reducción en rotación de personal técnico en PYMEs certificadas.",
                corp_badge: "ESCALA Y CUMPLIMIENTO",
                corp_head: "Contratación Masiva, Cero Dolor.",
                corp_desc: "¿Necesitas 50 técnicos para el lunes? Tenemos el pool pre-validado. Integración con tu ATS incluida.",
                corp_btn: "Agendar Estrategia",
                corp_dash: "Dashboard Corporativo",
                dash_active: "Técnicos Activos",
                dash_trust: "Índice de Confianza",
                talent_tag: "Para El Profesional",
                talent_head_1: "Deja de competir por precio.",
                talent_head_2: "Cobra por tu calidad.",
                talent_desc: "Los amateurs cobran barato y arruinan el mercado. Tú eres un experto. Demuéstralo. Nuestra insignia te separa del montón y te consigue clientes que valoran la calidad.",
                feat1_title: "La Insignia \"Elite\"",
                feat1_desc: "Un sello físico y digital que genera confianza instantánea con dueños de casa y gerentes.",
                feat2_title: "Tarifas Premium",
                feat2_desc: "Nuestros pros certificados ganan un 35% más porque ofrecen cero riesgo al cliente.",
                talent_btn: "Reclamar mi Insignia ($20)",
                cert_title: "Certificado de Competencia",
                cert_spec: "Especialidad",
                cert_score: "Puntaje Técnico",
                cert_bg: "Antecedentes",
                footer_tag: "El nuevo estándar de confianza.",
                portal_title: "Portal Nexyana (Demo)",
                portal_subtitle: "Mock estático que se siente real: recuerda tus acciones y desbloquea secciones.",
                portal_btn_db: "Ir a la base",
                portal_btn_panel: "Ir a mi panel",
                portal_btn_reset: "Reiniciar demo",
                db_tag: "Base de Datos Nexyana",
                db_title: "Talento verificado con señales de confianza",
                db_desc: "Filtra y previsualiza perfiles. El contacto se oculta hasta desbloquear.",
                db_unlock_btn: "Desbloquear Acceso ($49)",
                db_back_btn: "Ver planes",
                db_filter_trade: "Oficio",
                db_filter_city: "Ciudad",
                db_filter_zone: "Zona",
                db_filter_trust: "Filtros de confianza",
                db_filter_all: "Todos",
                db_zone_any: "Cualquiera",
                db_zone_north: "Quito Norte",
                db_zone_center: "Quito Centro",
                db_zone_south: "Quito Sur",
                db_zone_valleys: "Valles (Cumbayá/Tumbaco)",
                db_trust_any: "Cualquiera",
                db_trust_bg: "Antecedentes verificados",
                db_trust_score: "Score 90+",
                db_trust_verified: "Verificado por Nexyana",
                db_geo_btn: "Usar mi ubicación (opcional)",
                db_geo_clear: "Olvidar ubicación",
                db_geo_note: "Funciona en HTTPS o localhost. Se guarda solo en tu navegador.",
                db_view_list: "Lista",
                db_view_map: "Mapa",
                db_segment_label: "Segmento",
                seg_particular: "Particular",
                db_map_tag: "Mapa (Demo)",
                db_map_title: "Disponibilidad + demanda por segmento",
                db_map_hint: "Toca un pin para ver detalles",
                db_map_legend_supply: "Talento",
                db_map_legend_demand: "Demanda",
                db_map_legend_you: "Tú",
                db_map_detail_title: "Detalle",
                db_map_detail_desc: "Selecciona un punto del mapa.",
                db_map_detail_empty: "Ningún punto seleccionado.",
                db_locked_title: "Datos protegidos",
                db_locked_desc: "Desbloquea para ver contacto + evidencia (mock).",
                db_locked_cta: "Desbloquear ahora",
                panel_tag: "Portal de Talento",
                panel_title: "Tu ruta de verificación",
                panel_desc: "Dashboard simple (mock) que cambia a medida que avanzas.",
                panel_btn_advance: "Avanzar paso (demo)",
                panel_btn_db: "Ver base",
                panel_progress: "Progreso",
                panel_card_title: "Tu ID Nexyana",
                panel_card_desc: "Muestra este QR en el centro de examen (mock).",
                panel_card_cta: "Actualizar mi perfil",
                form_name: "Nombre completo",
                form_phone: "WhatsApp (opcional)",
                form_years: "Años de experiencia",
                form_city: "Ciudad",
                form_docs: "ID / domicilio (mock)",
                form_segment: "Segmento",
                seg_home: "Hogar",
                seg_sme: "PYME",
                seg_corp: "Corporativo",
                form_role: "Tu Oficio / Especialidad",
                form_need: "¿Qué perfil buscas contratar?",
                form_email: "Tu Correo Electrónico",
                success_title: "¡Recibido!",
                success_desc: "Te hemos enviado los siguientes pasos a tu correo.",
                modal_talent_title: "Reserva tu fecha de examen",
                modal_talent_subtitle: "Estamos abriendo cupos para certificación técnica en tu zona.",
                modal_client_title: "Estás a un paso de contratar seguro",
                modal_client_subtitle: "Asegura tu tarifa preferencial.",
                btn_continue: "Continuar",
                success_to_panel: "Ir a mi panel",
                success_to_checkout: "Continuar a desbloqueo (mock)",
                success_to_db: "Ir a la base"
            }
        };

        let currentLang = 'es';

        function setLanguage(lang) {
            currentLang = lang;
            try { localStorage.setItem('nexyana_lang_v1', lang); } catch (e) {}
            
            // Update Buttons Style
            document.getElementById('btn-en').className = lang === 'en' 
                ? 'px-3 py-1 text-xs font-bold rounded-md transition-colors bg-white text-brand-primary shadow-sm'
                : 'px-3 py-1 text-xs font-bold rounded-md transition-colors text-slate-500 hover:text-slate-700';
                
            document.getElementById('btn-es').className = lang === 'es' 
                ? 'px-3 py-1 text-xs font-bold rounded-md transition-colors bg-white text-brand-primary shadow-sm'
                : 'px-3 py-1 text-xs font-bold rounded-md transition-colors text-slate-500 hover:text-slate-700';

            // Update Text Nodes
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    // Check if content has HTML tags
                    if (translations[lang][key].includes('<')) {
                        el.innerHTML = translations[lang][key];
                    } else {
                        el.innerText = translations[lang][key];
                    }
                }
            });
            
            // Update Modal Button if exists
            const btn = document.getElementById('submitBtn');
            if(btn) btn.innerText = translations[lang]['btn_continue'];

            // Re-render portal UI (if visible)
            renderDb();
            renderTalentPanel();
        }

        // --- REAL TIME NOTIFICATIONS (Mock Data: Ecuador) ---
        const notifications = [
            { name: "Juan P.", role_en: "Plumber", role_es: "Plomero", city: "Quito" },
            { name: "Andrea G.", role_en: "Electrician", role_es: "Electricista", city: "Quito" },
            { name: "Luis R.", role_en: "Carpenter", role_es: "Carpintero", city: "Quito" },
            { name: "Maria S.", role_en: "Dishwasher", role_es: "Lavaplatos", city: "Quito" },
            { name: "Ana M.", role_en: "Registered", role_es: "Registró", city: "Quito" },
            { name: "Sofia L.", role_en: "Contracted", role_es: "Contrató", city: "Quito" },
            { name: "Pedro C.", role_en: "Plumber", role_es: "Plomero", city: "Cumbayá" },
            { name: "Kevin V.", role_en: "Electrician", role_es: "Electricista", city: "Tumbaco" }
        ];

        function showNotification() {
            const toast = document.getElementById('toast');
            const title = document.getElementById('toast-title');
            const body = document.getElementById('toast-body');

            // Pick random data
            const random = notifications[Math.floor(Math.random() * notifications.length)];
            
            // Set content based on current lang
            const role = currentLang === 'en' ? random.role_en : random.role_es;
            const action = currentLang === 'en' ? "Active in" : "Activo en";
            
            title.innerText = currentLang === 'en' ? "New Activity" : "Nueva Actividad";
            body.innerText = `${random.name} - ${role} (${action} ${random.city})`;

            // Show
            toast.classList.remove('hidden', 'translate-y-full');
            
            // Hide after 4 seconds
            setTimeout(() => {
                toast.classList.add('translate-y-full');
            }, 4000);
        }

        // Start notification loop
        setTimeout(() => {
            showNotification(); // First one after 2s
            setInterval(showNotification, 8000); // Then every 8s
        }, 2000);

        // --- TAB LOGIC ---
        function switchTab(tabName) {
            ['hogar', 'pyme', 'corp'].forEach(t => {
                document.getElementById(`content-${t}`).classList.add('hidden');
                document.getElementById(`tab-${t}`).classList.remove('tab-active');
                document.getElementById(`tab-${t}`).classList.add('tab-inactive');
            });
            document.getElementById(`content-${tabName}`).classList.remove('hidden');
            const activeTab = document.getElementById(`tab-${tabName}`);
            activeTab.classList.remove('tab-inactive');
            activeTab.classList.add('tab-active');
        }

        // --- SCROLL LOGIC ---
        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
        }

        // --- HASH ROUTING (GitHub Pages friendly) ---
        function navigate(hash) {
            window.location.hash = hash;
        }

        // --- MOBILE MENU ---
        function toggleMobileMenu() {
            const panel = document.getElementById('mobileMenu');
            const btn = document.getElementById('mobileMenuBtn');
            if (!panel || !btn) return;
            const isHidden = panel.classList.contains('hidden');
            panel.classList.toggle('hidden', !isHidden);
            btn.setAttribute('aria-expanded', String(isHidden));
        }

        function closeMobileMenu() {
            const panel = document.getElementById('mobileMenu');
            const btn = document.getElementById('mobileMenuBtn');
            if (!panel || !btn) return;
            panel.classList.add('hidden');
            btn.setAttribute('aria-expanded', 'false');
        }

        // --- MODAL LOGIC ---
        const modal = document.getElementById('validationModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalSubtitle = document.getElementById('modalSubtitle');
        const talentFields = document.getElementById('talentFields');
        const clientFields = document.getElementById('clientFields');
        const leadTypeInput = document.getElementById('leadType');
        const planInput = document.getElementById('planInterest');
        const form = document.getElementById('leadForm');
        const successMsg = document.getElementById('successMessage');
        const submitBtn = document.getElementById('submitBtn');
        const successActions = document.getElementById('successActions');

        function openModal(type, planName) {
            form.classList.remove('hidden');
            successMsg.classList.add('hidden');
            form.reset();
            leadTypeInput.value = type;
            planInput.value = planName;
            if (successActions) successActions.innerHTML = '';

            if (type === 'talent') {
                modalTitle.innerText = translations[currentLang]['modal_talent_title'];
                modalSubtitle.innerText = translations[currentLang]['modal_talent_subtitle'];
                talentFields.classList.remove('hidden');
                clientFields.classList.add('hidden');
            } else {
                modalTitle.innerText = translations[currentLang]['modal_client_title'];
                modalSubtitle.innerText = `${translations[currentLang]['modal_client_subtitle']} (${planName})`;
                talentFields.classList.add('hidden');
                clientFields.classList.remove('hidden');
            }
            modal.classList.remove('hidden');
        }

        function closeModal() {
            modal.classList.add('hidden');
        }

        function submitForm(e) {
            e.preventDefault();
            submitBtn.disabled = true;
            submitBtn.innerText = "...";
            
            const type = leadTypeInput.value;
            const plan = planInput.value || '';
            const email = (document.getElementById('leadEmail')?.value || '').trim();
            const name = (document.getElementById('leadName')?.value || '').trim();
            const phone = (document.getElementById('leadPhone')?.value || '').trim();
            const now = new Date().toISOString();

            const baseSession = loadSession() || {};

            setTimeout(() => {
                if (type === 'talent') {
                    const trade = document.getElementById('talentTrade')?.value || 'Other';
                    const years = Number(document.getElementById('talentYears')?.value || 0);
                    const city = (document.getElementById('talentCity')?.value || '').trim();
                    const id = baseSession?.talent?.id || `NEX-${Math.floor(1000 + Math.random() * 9000)}`;

                    const session = {
                        role: 'talent',
                        createdAt: baseSession.createdAt || now,
                        updatedAt: now,
                        lead: { type, plan, email, name, phone },
                        talent: {
                            id,
                            trade,
                            years,
                            city,
                            step: baseSession?.talent?.step || 1 // 1..5
                        }
                    };
                    saveSession(session);

                    if (successActions) {
                        successActions.innerHTML = `
                            <button onclick="closeModal(); navigate('#/panel')" class="w-full sm:w-auto px-5 py-3 rounded-lg bg-brand-primary text-white font-bold hover:bg-teal-800">${translations[currentLang]['success_to_panel'] || 'Mi Panel'}</button>
                            <button onclick="closeModal(); navigate('#/db')" class="w-full sm:w-auto px-5 py-3 rounded-lg bg-white border border-slate-300 text-slate-800 font-bold hover:bg-slate-50">${translations[currentLang]['success_to_db'] || 'Base'}</button>
                        `;
                    }
                    showToast(
                        currentLang === 'en' ? 'Talent saved' : 'Talento guardado',
                        currentLang === 'en' ? 'Your demo dashboard is ready.' : 'Tu panel demo está listo.'
                    );
                } else {
                    const need = (document.getElementById('clientNeed')?.value || '').trim();
                    const segment = document.getElementById('clientSegment')?.value || 'home';
                    const city = (document.getElementById('clientCity')?.value || '').trim();

                    const session = {
                        role: 'client',
                        createdAt: baseSession.createdAt || now,
                        updatedAt: now,
                        lead: { type, plan, email, name, phone },
                        client: {
                            segment,
                            city,
                            need,
                            unlocked: baseSession?.client?.unlocked || false
                        }
                    };
                    saveSession(session);

                    if (successActions) {
                        successActions.innerHTML = `
                            <button onclick="closeModal(); openCheckout()" class="w-full sm:w-auto px-5 py-3 rounded-lg bg-brand-primary text-white font-bold hover:bg-teal-800">${translations[currentLang]['success_to_checkout'] || 'Desbloquear (mock)'}</button>
                            <button onclick="closeModal(); navigate('#/db')" class="w-full sm:w-auto px-5 py-3 rounded-lg bg-white border border-slate-300 text-slate-800 font-bold hover:bg-slate-50">${translations[currentLang]['success_to_db'] || 'Base'}</button>
                        `;
                    }
                    showToast(
                        currentLang === 'en' ? 'Request saved' : 'Solicitud guardada',
                        currentLang === 'en' ? 'Continue to unlock (mock) to view contacts.' : 'Continúa al desbloqueo (mock) para ver contactos.'
                    );
                }

                form.classList.add('hidden');
                successMsg.classList.remove('hidden');
                submitBtn.disabled = false;
                submitBtn.innerText = translations[currentLang]['btn_continue'];

                updateNav();
                renderDb();
                renderTalentPanel();
            }, 900);
        }

        // --- STATE (localStorage) ---
        const STORAGE_KEY = 'nexyana_session_v1';
        const LANG_KEY = 'nexyana_lang_v1';

        function loadSession() {
            try {
                const raw = localStorage.getItem(STORAGE_KEY);
                return raw ? JSON.parse(raw) : null;
            } catch (e) {
                return null;
            }
        }

        function saveSession(session) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(session));
        }

        function resetDemo() {
            localStorage.removeItem(STORAGE_KEY);
            updateNav();
            showToast(currentLang === 'en' ? 'Demo reset' : 'Demo reiniciada', currentLang === 'en' ? 'Your session was cleared.' : 'Se borró tu sesión.');
            handleRoute();
        }

        function isUnlocked() {
            const session = loadSession();
            return !!(session?.role === 'client' && session?.client?.unlocked);
        }

        // --- TOAST helper (reuses existing UI) ---
        function showToast(titleText, bodyText) {
            const title = document.getElementById('toast-title');
            const body = document.getElementById('toast-body');
            const toast = document.getElementById('toast');
            if (!title || !body || !toast) return;
            title.innerText = titleText;
            body.innerText = bodyText;
            toast.classList.remove('hidden', 'translate-y-full');
            setTimeout(() => toast.classList.add('translate-y-full'), 4000);
        }

        // --- MOCK CHECKOUT ---
        function openCheckout() {
            const session = loadSession();
            if (!session || session.role !== 'client') {
                openModal('client', 'Acceso Hogar - $49');
                return;
            }

            form.classList.add('hidden');
            successMsg.classList.remove('hidden');
            modalTitle.innerText = currentLang === 'en' ? 'Checkout (Mock)' : 'Pago (Mock)';
            modalSubtitle.innerText = currentLang === 'en'
                ? 'This simulates Stripe/MercadoPago for the MVP demo.'
                : 'Esto simula Stripe/MercadoPago para la demo del MVP.';

            if (successActions) {
                successActions.innerHTML = `
                    <button onclick="simulatePayUnlock()" class="w-full sm:w-auto px-5 py-3 rounded-lg bg-brand-dark text-white font-bold hover:bg-slate-800">${currentLang === 'en' ? 'Pay now (mock)' : 'Pagar ahora (mock)'}</button>
                    <button onclick="closeModal(); navigate('#/db')" class="w-full sm:w-auto px-5 py-3 rounded-lg bg-white border border-slate-300 text-slate-800 font-bold hover:bg-slate-50">${translations[currentLang]['success_to_db'] || 'Base'}</button>
                `;
            }
            modal.classList.remove('hidden');
        }

        function simulatePayUnlock() {
            const session = loadSession();
            if (!session || session.role !== 'client') return;
            session.client.unlocked = true;
            session.updatedAt = new Date().toISOString();
            saveSession(session);
            closeModal();
            showToast(currentLang === 'en' ? 'Access unlocked' : 'Acceso desbloqueado', currentLang === 'en' ? 'Contacts are now visible (mock).' : 'El contacto ya es visible (mock).');
            navigate('#/db');
            renderDb();
        }

        // --- DB RENDER ---
        const MOCK_TALENT = [
            { first: "Carlos", last: "M.", trade: "Plumber", city: "Quito", zone: "Centro", lat: -0.2202, lon: -78.5120, score: 96, bg: true, verified: true, level: "Gold", contact: "carlos@nexyana.com" },
            { first: "Andrea", last: "G.", trade: "Electrician", city: "Quito", zone: "Norte", lat: -0.1763, lon: -78.4807, score: 92, bg: true, verified: false, level: "Silver", contact: "andrea@nexyana.com" },
            { first: "Luis", last: "R.", trade: "Carpenter", city: "Quito", zone: "Sur", lat: -0.2740, lon: -78.5530, score: 94, bg: true, verified: true, level: "Gold", contact: "luis@nexyana.com" },
            { first: "Maria", last: "S.", trade: "Dishwasher", city: "Quito", zone: "Centro", lat: -0.2299, lon: -78.5249, score: 86, bg: true, verified: false, level: "Bronze", contact: "maria@nexyana.com" },
            { first: "Pedro", last: "C.", trade: "Plumber", city: "Cumbayá", zone: "Valles", lat: -0.1996, lon: -78.4334, score: 90, bg: true, verified: false, level: "Silver", contact: "pedro@nexyana.com" },
            { first: "Kevin", last: "V.", trade: "Electrician", city: "Tumbaco", zone: "Valles", lat: -0.2150, lon: -78.4109, score: 93, bg: true, verified: true, level: "Gold", contact: "kevin@nexyana.com" },
            { first: "Sofia", last: "L.", trade: "Carpenter", city: "Quito", zone: "Norte", lat: -0.1605, lon: -78.4869, score: 91, bg: true, verified: false, level: "Silver", contact: "sofia@nexyana.com" }
        ];

        // --- GEO (optional) ---
        const GEO_KEY = 'nexyana_geo_coords_v1';
        const DB_PREFILL_KEY = 'nexyana_db_prefill_v1';
        const DB_VIEW_KEY = 'nexyana_db_view_v1';

        const MAP_BOUNDS = {
            // Rough bounding box for Quito + valleys
            latMin: -0.30,
            latMax: -0.14,
            lonMin: -78.58,
            lonMax: -78.38,
        };

        const MOCK_DEMAND = [
            { id: 'd1', segment: 'home', label_es: 'Particulares (hogar)', label_en: 'Home (individuals)', zone: 'Norte', city: 'Quito', lat: -0.1700, lon: -78.4900, count: 18 },
            { id: 'd2', segment: 'home', label_es: 'Particulares (hogar)', label_en: 'Home (individuals)', zone: 'Centro', city: 'Quito', lat: -0.2250, lon: -78.5200, count: 22 },
            { id: 'd3', segment: 'home', label_es: 'Particulares (hogar)', label_en: 'Home (individuals)', zone: 'Sur', city: 'Quito', lat: -0.2750, lon: -78.5500, count: 14 },
            { id: 'd4', segment: 'sme', label_es: 'PYMEs', label_en: 'SMBs', zone: 'Centro', city: 'Quito', lat: -0.2100, lon: -78.5050, count: 9 },
            { id: 'd5', segment: 'sme', label_es: 'PYMEs', label_en: 'SMBs', zone: 'Norte', city: 'Quito', lat: -0.1550, lon: -78.4750, count: 7 },
            { id: 'd6', segment: 'corp', label_es: 'Corporativo', label_en: 'Corporate', zone: 'Valles', city: 'Cumbayá', lat: -0.1996, lon: -78.4334, count: 4 },
            { id: 'd7', segment: 'corp', label_es: 'Corporativo', label_en: 'Corporate', zone: 'Valles', city: 'Tumbaco', lat: -0.2150, lon: -78.4109, count: 3 },
        ];

        function loadGeo() {
            try {
                const raw = localStorage.getItem(GEO_KEY);
                return raw ? JSON.parse(raw) : null;
            } catch (e) {
                return null;
            }
        }

        function saveGeo(coords) {
            localStorage.setItem(GEO_KEY, JSON.stringify(coords));
        }

        function clearGeo() {
            localStorage.removeItem(GEO_KEY);
            showToast(currentLang === 'en' ? 'Location cleared' : 'Ubicación borrada', currentLang === 'en' ? 'Sorting by distance is off.' : 'Se desactivó la cercanía.');
            renderDb();
        }

        function requestGeo() {
            if (!navigator.geolocation) {
                showToast(currentLang === 'en' ? 'Not supported' : 'No compatible', currentLang === 'en' ? 'Geolocation is not available in this browser.' : 'Geolocalización no disponible en este navegador.');
                return;
            }
            navigator.geolocation.getCurrentPosition(
                (pos) => {
                    saveGeo({ lat: pos.coords.latitude, lon: pos.coords.longitude, ts: Date.now() });
                    showToast(currentLang === 'en' ? 'Location enabled' : 'Ubicación activada', currentLang === 'en' ? 'Now sorting by proximity (mock).' : 'Ahora ordenamos por cercanía (mock).');
                    renderDb();
                },
                () => {
                    showToast(currentLang === 'en' ? 'Permission denied' : 'Permiso denegado', currentLang === 'en' ? 'Enable location to sort by proximity.' : 'Activa ubicación para ordenar por cercanía.');
                },
                { enableHighAccuracy: false, timeout: 8000, maximumAge: 60000 }
            );
        }

        function haversineKm(a, b) {
            const toRad = (x) => (x * Math.PI) / 180;
            const R = 6371;
            const dLat = toRad(b.lat - a.lat);
            const dLon = toRad(b.lon - a.lon);
            const lat1 = toRad(a.lat);
            const lat2 = toRad(b.lat);
            const s =
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(lat1) * Math.cos(lat2) * Math.sin(dLon / 2) * Math.sin(dLon / 2);
            return 2 * R * Math.atan2(Math.sqrt(s), Math.sqrt(1 - s));
        }

        function clamp(n, min, max) {
            return Math.max(min, Math.min(max, n));
        }

        function latLonToXY(lat, lon) {
            const x = (lon - MAP_BOUNDS.lonMin) / (MAP_BOUNDS.lonMax - MAP_BOUNDS.lonMin);
            const y = (MAP_BOUNDS.latMax - lat) / (MAP_BOUNDS.latMax - MAP_BOUNDS.latMin);
            return {
                x: clamp(x, 0, 1),
                y: clamp(y, 0, 1),
            };
        }

        function setDbView(mode) {
            try { localStorage.setItem(DB_VIEW_KEY, mode); } catch (e) {}
            const listBtn = document.getElementById('dbViewListBtn');
            const mapBtn = document.getElementById('dbViewMapBtn');
            const listView = document.getElementById('dbListView');
            const mapView = document.getElementById('dbMapView');
            if (!listBtn || !mapBtn || !listView || !mapView) return;

            const isMap = mode === 'map';
            listView.classList.toggle('hidden', isMap);
            mapView.classList.toggle('hidden', !isMap);

            listBtn.className = isMap
                ? 'px-3 py-2 text-sm font-bold rounded-md text-slate-700 hover:bg-slate-50'
                : 'px-3 py-2 text-sm font-bold rounded-md bg-slate-900 text-white';
            mapBtn.className = isMap
                ? 'px-3 py-2 text-sm font-bold rounded-md bg-slate-900 text-white'
                : 'px-3 py-2 text-sm font-bold rounded-md text-slate-700 hover:bg-slate-50';

            if (isMap) renderDbMap();
            else renderDb();
        }

        function getDbView() {
            try {
                return localStorage.getItem(DB_VIEW_KEY) || 'list';
            } catch (e) {
                return 'list';
            }
        }

        function renderDbMap() {
            const mapEl = document.getElementById('dbLeafletMap');
            const detail = document.getElementById('dbMapDetail');
            const stats = document.getElementById('dbMapStats');
            if (!mapEl || !detail) return;

            if (typeof window.L === 'undefined') {
                // Leaflet not loaded (offline)
                mapEl.innerHTML = `<div class="p-6 text-sm text-slate-600">${currentLang === 'en' ? 'Map library not loaded. Try running on localhost/online.' : 'No se cargó el mapa. Prueba en localhost/con internet.'}</div>`;
                return;
            }

            const trade = (document.getElementById('dbFilterTrade')?.value || 'all');
            const city = (document.getElementById('dbFilterCity')?.value || '').trim().toLowerCase();
            const zone = (document.getElementById('dbFilterZone')?.value || 'any');
            const trust = (document.getElementById('dbFilterTrust')?.value || 'any');
            const segment = (document.getElementById('dbDemandSegment')?.value || 'home');

            const unlocked = isUnlocked();
            const geo = loadGeo();

            const filteredSupply = MOCK_TALENT.filter(p => {
                if (trade !== 'all' && p.trade !== trade) return false;
                if (city && !p.city.toLowerCase().includes(city)) return false;
                if (zone !== 'any' && (p.zone || '') !== zone) return false;
                if (trust === 'bg_ok' && !p.bg) return false;
                if (trust === 'score_90' && p.score < 90) return false;
                if (trust === 'verified' && !p.verified) return false;
                return true;
            });

            const demandPins = MOCK_DEMAND.filter(d => {
                if (d.segment !== segment) return false;
                if (city && !d.city.toLowerCase().includes(city)) return false;
                if (zone !== 'any' && (d.zone || '') !== zone) return false;
                return true;
            });

            const supplyCount = filteredSupply.length;
            const demandCount = demandPins.reduce((acc, d) => acc + d.count, 0);
            if (stats) {
                stats.innerText = currentLang === 'en'
                    ? `${supplyCount} pros • ${demandCount} demand (mock)`
                    : `${supplyCount} pros • ${demandCount} demanda (mock)`;
            }

            // Keep Leaflet map instance around
            if (!window.__nexyanaLeaflet) {
                const map = L.map(mapEl, {
                    zoomControl: true,
                    attributionControl: true,
                    scrollWheelZoom: false,
                }).setView([-0.1807, -78.4678], 12);

                // CARTO tiles (nice “Google-like” basemap)
                L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                    subdomains: 'abcd',
                    maxZoom: 19,
                    attribution: '&copy; OpenStreetMap contributors &copy; CARTO',
                }).addTo(map);

                const layers = {
                    supply: L.layerGroup().addTo(map),
                    demand: L.layerGroup().addTo(map),
                    you: L.layerGroup().addTo(map),
                };

                window.__nexyanaLeaflet = { map, layers, lastCenter: map.getCenter(), lastZoom: map.getZoom() };
            }

            const { map, layers } = window.__nexyanaLeaflet;
            layers.supply.clearLayers();
            layers.demand.clearLayers();
            layers.you.clearLayers();

            // Marker styles
            const supplyIcon = (verified) => L.divIcon({
                className: '',
                html: `<div style="
                    width: 14px; height: 14px; border-radius: 9999px;
                    background: ${verified ? '#0f766e' : '#14b8a6'};
                    border: 2px solid #0f172a;
                    box-shadow: 0 6px 14px rgba(15,23,42,0.18);
                "></div>`,
                iconSize: [14, 14],
                iconAnchor: [7, 7],
            });

            const demandIcon = (count) => L.divIcon({
                className: '',
                html: `<div style="
                    min-width: 28px; height: 28px; border-radius: 9999px;
                    background: #d97706;
                    border: 2px solid #0f172a;
                    color: white;
                    font-weight: 800;
                    font-size: 12px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    box-shadow: 0 10px 22px rgba(15,23,42,0.18);
                ">${count}</div>`,
                iconSize: [28, 28],
                iconAnchor: [14, 14],
            });

            const youIcon = L.divIcon({
                className: '',
                html: `<div style="
                    width: 16px; height: 16px; border-radius: 9999px;
                    background: #0f172a;
                    border: 3px solid white;
                    box-shadow: 0 10px 24px rgba(15,23,42,0.25);
                "></div>`,
                iconSize: [16, 16],
                iconAnchor: [8, 8],
            });

            // Add supply markers
            filteredSupply.forEach((p, idx) => {
                if (typeof p.lat !== 'number' || typeof p.lon !== 'number') return;
                const m = L.marker([p.lat, p.lon], { icon: supplyIcon(p.verified) })
                    .addTo(layers.supply)
                    .on('click', () => selectMapPoint('supply', idx));
                m.bindTooltip(`${p.first} ${p.last} • ${p.trade}`, { direction: 'top', opacity: 0.9, sticky: true });
            });

            // Add demand markers
            demandPins.forEach((d, idx) => {
                const m = L.marker([d.lat, d.lon], { icon: demandIcon(d.count) })
                    .addTo(layers.demand)
                    .on('click', () => selectMapPoint('demand', idx));
                m.bindTooltip(`${currentLang === 'en' ? d.label_en : d.label_es} • ${d.count}`, { direction: 'top', opacity: 0.9, sticky: true });
            });

            // Add user marker if available
            if (geo) {
                L.marker([geo.lat, geo.lon], { icon: youIcon }).addTo(layers.you);
                L.circle([geo.lat, geo.lon], { radius: 600, color: '#0f172a', weight: 1, fillColor: '#0f172a', fillOpacity: 0.08 }).addTo(layers.you);
            }

            // Fit bounds to visible points (only on first open or if map hasn't been used)
            const points = [];
            filteredSupply.forEach(p => (typeof p.lat === 'number' && typeof p.lon === 'number') && points.push([p.lat, p.lon]));
            demandPins.forEach(d => points.push([d.lat, d.lon]));
            if (geo) points.push([geo.lat, geo.lon]);

            try {
                if (points.length) {
                    const b = L.latLngBounds(points);
                    map.fitBounds(b.pad(0.25), { animate: false });
                } else {
                    map.setView([-0.1807, -78.4678], 12, { animate: false });
                }
                setTimeout(() => map.invalidateSize(), 50);
            } catch (e) {}

            // If nothing selected, keep an informative placeholder
            if (!detail.dataset.selected) {
                detail.innerHTML = `
                    <div class="bg-slate-50 border border-slate-200 rounded-xl p-4 text-sm text-slate-600">
                        ${translations[currentLang]['db_map_detail_empty'] || (currentLang === 'en' ? 'No point selected.' : 'Ningún punto seleccionado.')}
                    </div>
                `;
            }

            // store for selection handler
            window.__nexyanaMap = {
                supply: filteredSupply,
                demand: demandPins,
                unlocked,
                geo,
                segment,
            };
        }

        function selectMapPoint(kind, index) {
            const detail = document.getElementById('dbMapDetail');
            if (!detail || !window.__nexyanaMap) return;
            detail.dataset.selected = '1';

            if (kind === 'supply') {
                const p = window.__nexyanaMap.supply[index];
                if (!p) return;
                const contact = window.__nexyanaMap.unlocked ? p.contact : '••••••••••••';
                detail.innerHTML = `
                    <div class="bg-white border border-slate-200 rounded-xl p-4">
                        <div class="flex items-start justify-between gap-3">
                            <div>
                                <div class="font-extrabold text-slate-900">${p.first} ${p.last}</div>
                                <div class="text-xs text-slate-500">${p.trade} • ${p.city} • ${p.zone}</div>
                            </div>
                            <span class="text-xs px-2 py-1 rounded ${p.verified ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'} font-bold">
                                ${p.verified ? (currentLang === 'en' ? 'VERIFIED' : 'VERIFICADO') : (currentLang === 'en' ? 'PRE-VETTED' : 'PRE-FILTRADO')}
                            </span>
                        </div>
                        <div class="mt-3 grid grid-cols-3 gap-2 text-xs">
                            <div class="bg-slate-50 border border-slate-200 rounded-lg p-2">
                                <div class="text-slate-500">${currentLang === 'en' ? 'Score' : 'Score'}</div>
                                <div class="font-bold text-slate-900">${p.score}/100</div>
                            </div>
                            <div class="bg-slate-50 border border-slate-200 rounded-lg p-2">
                                <div class="text-slate-500">${currentLang === 'en' ? 'Level' : 'Nivel'}</div>
                                <div class="font-bold text-slate-900">${p.level}</div>
                            </div>
                            <div class="bg-slate-50 border border-slate-200 rounded-lg p-2">
                                <div class="text-slate-500">${currentLang === 'en' ? 'Background' : 'Antecedentes'}</div>
                                <div class="font-bold text-slate-900">${p.bg ? 'OK' : (currentLang === 'en' ? 'Pending' : 'Pendiente')}</div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <div class="text-xs text-slate-500">${currentLang === 'en' ? 'Contact' : 'Contacto'}</div>
                            <div class="font-mono font-bold text-slate-900">${contact}</div>
                        </div>
                        <div class="mt-4">
                            <button onclick="${window.__nexyanaMap.unlocked ? `showToast('${currentLang === 'en' ? 'Chat opened (mock)' : 'Chat abierto (mock)'}','${currentLang === 'en' ? 'This would be an in-app chat.' : 'Aquí iría un chat interno.'}')` : 'openCheckout()'}" class="w-full px-4 py-2 rounded-lg ${window.__nexyanaMap.unlocked ? 'bg-brand-primary text-white hover:bg-teal-800' : 'bg-slate-900 text-white hover:bg-slate-800'} font-bold">
                                ${window.__nexyanaMap.unlocked ? (currentLang === 'en' ? 'Message' : 'Mensaje') : (currentLang === 'en' ? 'Unlock' : 'Desbloquear')}
                            </button>
                        </div>
                    </div>
                `;
                return;
            }

            if (kind === 'demand') {
                const d = window.__nexyanaMap.demand[index];
                if (!d) return;
                const label = currentLang === 'en' ? d.label_en : d.label_es;
                detail.innerHTML = `
                    <div class="bg-white border border-slate-200 rounded-xl p-4">
                        <div class="flex items-start justify-between gap-3">
                            <div>
                                <div class="font-extrabold text-slate-900">${label}</div>
                                <div class="text-xs text-slate-500">${d.city} • ${d.zone}</div>
                            </div>
                            <span class="text-xs px-2 py-1 rounded bg-amber-100 text-amber-700 font-bold">${d.count} ${currentLang === 'en' ? 'requests' : 'solicitudes'}</span>
                        </div>
                        <div class="mt-3 text-sm text-slate-600">
                            ${currentLang === 'en'
                                ? 'This pin represents simulated demand density for the selected segment.'
                                : 'Este pin representa densidad de demanda simulada para el segmento seleccionado.'}
                        </div>
                        <div class="mt-4">
                            <button onclick="openModal('client','Acceso - $49')" class="w-full px-4 py-2 rounded-lg bg-brand-dark text-white font-bold hover:bg-slate-800">
                                ${currentLang === 'en' ? 'Get access (mock)' : 'Pedir acceso (mock)'}
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        function renderDb() {
            const container = document.getElementById('dbResults');
            const overlay = document.getElementById('dbLockedOverlay');
            if (!container || !overlay) return;

            const trade = (document.getElementById('dbFilterTrade')?.value || 'all');
            const city = (document.getElementById('dbFilterCity')?.value || '').trim().toLowerCase();
            const zone = (document.getElementById('dbFilterZone')?.value || 'any');
            const trust = (document.getElementById('dbFilterTrust')?.value || 'any');
            const geo = loadGeo();

            const unlocked = isUnlocked();
            overlay.classList.toggle('hidden', unlocked);

            let filtered = MOCK_TALENT.filter(p => {
                if (trade !== 'all' && p.trade !== trade) return false;
                if (city && !p.city.toLowerCase().includes(city)) return false;
                if (zone !== 'any' && (p.zone || '') !== zone) return false;
                if (trust === 'bg_ok' && !p.bg) return false;
                if (trust === 'score_90' && p.score < 90) return false;
                if (trust === 'verified' && !p.verified) return false;
                return true;
            });

            if (geo) {
                filtered = filtered
                    .map(p => {
                        if (typeof p.lat === 'number' && typeof p.lon === 'number') {
                            return { ...p, distanceKm: haversineKm({ lat: geo.lat, lon: geo.lon }, { lat: p.lat, lon: p.lon }) };
                        }
                        return { ...p, distanceKm: null };
                    })
                    .sort((a, b) => {
                        if (a.distanceKm == null && b.distanceKm == null) return 0;
                        if (a.distanceKm == null) return 1;
                        if (b.distanceKm == null) return -1;
                        return a.distanceKm - b.distanceKm;
                    });
            }

            container.innerHTML = filtered.map(p => {
                const initials = `${p.first[0]}${p.last[0]}`;
                const badge = p.verified ? (currentLang === 'en' ? 'VERIFIED' : 'VERIFICADO') : (currentLang === 'en' ? 'PRE-VETTED' : 'PRE-FILTRADO');
                const badgeClass = p.verified ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700';
                const bgText = p.bg ? (currentLang === 'en' ? 'Background OK' : 'Antecedentes OK') : (currentLang === 'en' ? 'Background pending' : 'Antecedentes pendiente');
                const contact = unlocked ? p.contact : '••••••••••••';
                const btnText = unlocked ? (currentLang === 'en' ? 'Message' : 'Mensaje') : (currentLang === 'en' ? 'Unlock' : 'Desbloquear');
                const btnOnclick = unlocked
                    ? `showToast('${currentLang === 'en' ? 'Chat opened (mock)' : 'Chat abierto (mock)'}','${currentLang === 'en' ? 'This would be an in-app chat.' : 'Aquí iría un chat interno.'}')`
                    : 'openCheckout()';
                const zoneLabel = p.zone ? ` • ${p.zone}` : '';
                const distanceLabel = p.distanceKm != null ? `${p.distanceKm.toFixed(1)} km` : '';

                return `
                    <div class="bg-white border border-slate-200 rounded-xl p-5 hover:shadow-md transition">
                        <div class="flex items-start justify-between gap-3">
                            <div class="flex items-center gap-3">
                                <div class="h-12 w-12 rounded-full bg-slate-200 flex items-center justify-center text-slate-700 font-bold">${initials}</div>
                                <div>
                                    <div class="font-extrabold text-slate-900">${p.first} ${p.last}</div>
                                    <div class="text-xs text-slate-500">${p.trade} • ${p.city}${zoneLabel}${distanceLabel ? ` • ${distanceLabel}` : ''}</div>
                                </div>
                            </div>
                            <span class="text-xs px-2 py-1 rounded ${badgeClass} font-bold">${badge}</span>
                        </div>
                        <div class="mt-4 grid grid-cols-3 gap-2 text-xs">
                            <div class="bg-slate-50 border border-slate-200 rounded-lg p-2">
                                <div class="text-slate-500">${currentLang === 'en' ? 'Score' : 'Score'}</div>
                                <div class="font-bold text-slate-900">${p.score}/100</div>
                            </div>
                            <div class="bg-slate-50 border border-slate-200 rounded-lg p-2">
                                <div class="text-slate-500">${currentLang === 'en' ? 'Level' : 'Nivel'}</div>
                                <div class="font-bold text-slate-900">${p.level}</div>
                            </div>
                            <div class="bg-slate-50 border border-slate-200 rounded-lg p-2">
                                <div class="text-slate-500">${currentLang === 'en' ? 'Integrity' : 'Integridad'}</div>
                                <div class="font-bold text-slate-900">${bgText}</div>
                            </div>
                        </div>
                        <div class="mt-4 flex items-center justify-between gap-3">
                            <div class="text-sm">
                                <div class="text-xs text-slate-500">${currentLang === 'en' ? 'Contact' : 'Contacto'}</div>
                                <div class="font-mono font-bold text-slate-900">${contact}</div>
                            </div>
                            <button onclick="${btnOnclick}" class="px-4 py-2 rounded-lg ${unlocked ? 'bg-brand-primary text-white hover:bg-teal-800' : 'bg-slate-900 text-white hover:bg-slate-800'} font-bold">${btnText}</button>
                        </div>
                    </div>
                `;
            }).join('');

            // Keep view toggle consistent (if user switched to map)
            const view = getDbView();
            const listView = document.getElementById('dbListView');
            const mapView = document.getElementById('dbMapView');
            if (listView && mapView) {
                listView.classList.toggle('hidden', view === 'map');
                mapView.classList.toggle('hidden', view !== 'map');
            }
        }

        // --- TALENT PANEL ---
        function simulateTalentAdvance() {
            const session = loadSession();
            if (!session || session.role !== 'talent') {
                openModal('talent', 'Examen de Certificación - $20');
                return;
            }
            session.talent.step = Math.min(5, (session.talent.step || 1) + 1);
            session.updatedAt = new Date().toISOString();
            saveSession(session);
            renderTalentPanel();
            showToast(currentLang === 'en' ? 'Step updated' : 'Paso actualizado', currentLang === 'en' ? 'Your status advanced (demo).' : 'Tu estatus avanzó (demo).');
        }

        function renderTalentPanel() {
            const stepsContainer = document.getElementById('talentSteps');
            const bar = document.getElementById('talentProgressBar');
            const label = document.getElementById('talentProgressLabel');
            const idEl = document.getElementById('talentId');
            if (!stepsContainer || !bar || !label || !idEl) return;

            const session = loadSession();
            const step = session?.role === 'talent' ? (session.talent.step || 1) : 0;
            const pct = step ? Math.round((step / 5) * 100) : 0;
            label.innerText = `${pct}%`;
            bar.style.width = `${pct}%`;
            idEl.innerText = session?.talent?.id || 'NEX-0000';

            const labels = currentLang === 'en'
                ? ['Registered', 'Payment Confirmed', 'Exam Passed', 'Background Clean', 'VERIFIED BY NEXYANA']
                : ['Registrado', 'Pago Confirmado', 'Examen Aprobado', 'Antecedentes Limpios', 'VERIFICADO POR NEXYANA'];

            stepsContainer.innerHTML = labels.map((t, idx) => {
                const n = idx + 1;
                const done = step >= n;
                const pill = done ? (currentLang === 'en' ? 'Done' : 'Listo') : (currentLang === 'en' ? 'Pending' : 'Pendiente');
                const pillClass = done ? 'bg-green-100 text-green-700' : 'bg-slate-100 text-slate-600';
                return `
                    <div class="flex items-center justify-between bg-slate-50 border border-slate-200 rounded-xl p-4">
                        <div class="flex items-center gap-3">
                            <div class="h-9 w-9 rounded-lg ${done ? 'bg-green-600' : 'bg-slate-300'} text-white flex items-center justify-center font-extrabold">${n}</div>
                            <div>
                                <div class="font-extrabold text-slate-900">${t}</div>
                                <div class="text-xs text-slate-500">${currentLang === 'en' ? 'Status updates are simulated for the landing demo.' : 'Estatus simulado para demo de landing.'}</div>
                            </div>
                        </div>
                        <span class="text-xs px-2 py-1 rounded font-bold ${pillClass}">${pill}</span>
                    </div>
                `;
            }).join('');
        }

        // --- NAV + ROUTER ---
        function updateNav() {
            const session = loadSession();
            const panel = document.getElementById('nav-panel');
            if (!panel) return;
            panel.classList.toggle('hidden', !session);
        }

        function showPortal(show) {
            document.getElementById('portal')?.classList.toggle('hidden', !show);
        }

        function handleRoute() {
            const h = window.location.hash || '#/';
            const route = h.startsWith('#/') ? h.slice(2) : '';

            closeMobileMenu();

            showPortal(false);
            document.getElementById('portal-db')?.classList.add('hidden');
            document.getElementById('portal-panel')?.classList.add('hidden');

            if (!route || route === '/') return;

            if (route === 'empresas') {
                scrollToSection('clientes');
                switchTab('corp');
                return;
            }
            if (route === 'hogares') {
                scrollToSection('clientes');
                switchTab('hogar');
                return;
            }
            if (route === 'talento') {
                scrollToSection('talento');
                return;
            }
            if (route === 'db') {
                showPortal(true);
                document.getElementById('portal-db')?.classList.remove('hidden');
                // Prefill Quito only the first time the user visits the DB
                try {
                    const prefilled = localStorage.getItem(DB_PREFILL_KEY);
                    if (!prefilled) {
                        const cityInput = document.getElementById('dbFilterCity');
                        if (cityInput && !cityInput.value) cityInput.value = 'Quito';
                        localStorage.setItem(DB_PREFILL_KEY, '1');
                    }
                } catch (e) {}
                setDbView(getDbView());
                renderDb();
                renderDbMap();
                return;
            }
            if (route === 'panel') {
                showPortal(true);
                document.getElementById('portal-panel')?.classList.remove('hidden');
                renderTalentPanel();
                return;
            }
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });

        window.addEventListener('hashchange', handleRoute);

        (function init() {
            const storedLang = localStorage.getItem(LANG_KEY);
            setLanguage(storedLang || 'es');
            updateNav();
            handleRoute();
            renderDb();
            renderTalentPanel();
        })();
    </script>
</body>
</html>